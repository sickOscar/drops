version: "3"

volumes:
  sockets:

networks:
  drops:

services:

  core:
    image: drops/core
    restart: always
    build:
      context: core
      dockerfile: Dockerfile
    volumes:
      - sockets:/tmp/sockets
    depends_on:
      - server
    network_mode: "host"

  server:
    image: drops/server
    container_name: server
    build:
      context: server
      dockerfile: Dockerfile
    volumes:
      - sockets:/tmp/sockets

    environment:
      - SOCKET_TO_NODE=/tmp/sockets/drops_to_node.sock
      - SOCKET_FROM_NODE=/tmp/sockets/drops_from_node.sock
      - NODE_ENV=production
    network_mode: "host"

  frontend:
    image: drops/frontend
    container_name: frontend
    build:
      context: frontend
      dockerfile: Dockerfile

    environment:
      - VITE_MULTIPLAYER_HOST_GAME=ws://localhost/server
    network_mode: "host"

  http:
    image: nginx

    volumes:
      - ./conf/nginx:/etc/nginx/conf.d
#      - ./frontend/dist:/usr/share/nginx/html
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    network_mode: "host"